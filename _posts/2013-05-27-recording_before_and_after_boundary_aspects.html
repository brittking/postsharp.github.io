---
layout: post 
comments: true
title: "[Recording] Before and After: Boundary Aspects"
date: 2013-05-27 12:19:00 +02:00
permalink: /post/recording-before-and-after-boundary-aspects.html
author: "Britt King"
---
<p>Matthew Groves delivered part 3 of his 5-part live webinar series on AOP in .NET recently. The series covers insights <a href="http://www.manning.com/groves/">found in his new book</a> and a variety of real-world coding examples using PostSharp.</p>



<p>In part 3, Matt looks at a real-world application of a method boundary aspect to help with caching.&ndash; followed by a Q&amp;A session.</p>
<h2><iframe src="https://player.vimeo.com/video/66550886?title=0&amp;byline=0&amp;portrait=0&amp;loop=1" frameborder="0" width="640" height="460"></iframe></h2>
<h2>Q&amp;A</h2>
<p><strong>Q: Is OnExit always executed and, if yes, is it before or after OnSucess or OnException?</strong></p>
<p><strong>A:</strong> Imagine an invisible Try, Catch and Finally surrounding your method, then picture OnExit as being inside the Finally block of that imaginary Try/Catch block.</p>
<p>I say imaginary but, in the next episode, we will look at decompile and assembly and you&rsquo;ll see there is a real Try, Catch and Finally block being generated by PostSharp. So, OnExit will run after OnSuccess because the code and Finally runs after the code inside the Try block.</p>
<p><strong>Q: In the cache example is the data saved in the cache again, and is OnSucess even called or is it skipped because of the FlowBehavior?</strong></p>
<p><strong>A:</strong> When we set FlowBehavior to return that means OnSuccess, OnExit and OnException won&rsquo;t be called at all. It will just return immediately and those boundaries won&rsquo;t be executed, and it won&rsquo;t be stored in the cache again.</p>
<p><strong>Q: Instead of using a Cache object instantiated inside the aspect, is it possible to inject an implementation of it?</strong></p>
<p><strong>A:</strong> In my example I tightly coupled an aspect to a specific caching framework [ASP.NET cache]. If you&rsquo;re suggesting I should inject a dependency so I&rsquo;m working against an interface instead of directly against the ASP.NET cache, I agree with you.&nbsp; We&rsquo;ll talk more about that in the upcoming unit testing episode, because an important part of unit testing is not having those elements be tightly coupled.</p>
<p><strong>Q: How do we refresh the cache? Say if the value we are pulling from DB (say Median income) is changing every 10-15 minutes how can I keep my data up to date?</strong></p>
<p><strong>A:</strong> The answer depends on the caching framework you&rsquo;re using. With ASP.NET cache it has a default expiration of around 20 minutes. You can change that if you&rsquo;d like. In my example I set the cacheKey directly by writing:</p>
<pre>HttpContext.Current.Cache[cacheKey] = args.ReturnValue </pre>
<p>You can also use the Add method:</p>
<pre>HttpContext.Current.Cache.Add()</pre>
<p>Here I can add the key, the value, CacheDependency, absoluteExpiration time, slidingExpiration time, Priority, etc. So if the median income caches often, you may want to set it to expire more frequently than every 20 minutes.</p>
<p><strong>Q: Are there some useful pre-built caching aspects in PostSharp?</strong></p>
<p><strong>A:</strong> PostSharp 3 currently offers ready-made aspects to handle logging, INotifyPropertyChanged and multithreading. Ready-made caching is on the horizon. In the meantime, you may want to look at <a href="http://cache.codeplex.com/">Attribute Based Caching</a>, found on CodePlex, which uses PostSharp to handle many of the implementation practices talked about today.</p>
<p><strong>Q: In your upcoming book, will the examples/code work in PostSharp 2.1 or is the latest version 3 required?</strong></p>
<p><strong>A:</strong> When I started writing the book PostSharp 3 wasn&rsquo;t released yet so I mostly used version 2.1 to write the code. The coding examples however should work fine in either version.</p>
<p>Up next: Matt Groves goes <strong>Under the Hood of a Post-Compiler</strong>, showing how to decompile a .NET assembly and view code with and without a PostSharp aspect with Reflector.</p>
<p>-Britt</p>
